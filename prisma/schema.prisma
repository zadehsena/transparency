datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

generator client {
  provider = "prisma-client-js"
}

enum Visibility {
  everyone
  employers
  private
}

enum RemotePreference {
  remote
  hybrid
  onsite
  noPreference
}

enum Seniority {
  intern
  junior
  mid
  senior
  staff
  principal
  lead
}

model User {
  id          String   @id @default(cuid())
  email       String   @unique
  password    String
  firstName   String?
  lastName    String?
  birthdate   DateTime?
  location    String?
  interests  InterestGroup[]
  level       String?
  onboardingCompleted Boolean @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt @default(now()) // <-- add @default(now())
  applications Application[]
  profile      Profile?
}

model InterestGroup {
  id         String   @id @default(cuid())
  userId     String
  category   String            // e.g., "Tech", "Finance", "Healthcare"
  subtopics  String[]          // e.g., ["Software", "DevOps", "AI"]
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Company {
  id                 String   @id @default(cuid())
  slug               String   @unique
  name               String
  medianResponseDays Int?
  updatedAt          DateTime @updatedAt
  employeesLow        Int?
  employeesHigh       Int?
  medianBaseSalaryUSD Int?
  medianTCSalaryUSD   Int?
  foundedYear         Int?
  hqCity              String?
  overallResponseRate Int?
  totalApplications   Int?
  industry            String?
  hqCountry           String?
  website             String?
  stockTicker         String?
  stockExchange       String?
  revenueUSD          Int?
  businessUnits       BusinessUnit[]
  jobs                Job[]
  searchEvents        SearchEvent[]
}

model BusinessUnit {
  id                 String  @id @default(cuid())
  name               String
  applications       Int     @default(0)
  responses          Int     @default(0)
  interviews         Int     @default(0)
  offers             Int     @default(0)
  medianResponseDays Int?
  company            Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId          String
  jobs               Job[]
}

enum JobCategory {
  software
  data_analytics
  product_management
  design
  devops_sre
  security
  qa
  it_support
  marketing
  sales
  operations
  finance
  hr
  legal
  other
}

enum Region {
  north_america
  europe
  asia
  oceania
  latin_america
  middle_east
  africa
  remote
  global
}

model Job {
  id             String        @id @default(cuid())
  title          String
  company        String
  location       String
  source         String?
  url            String?
  ats            String
  externalId     String
  postedAt       DateTime      @default(now())
  closed         Boolean       @default(false)
  companyRel     Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId      String
  businessUnit   BusinessUnit? @relation(fields: [businessUnitId], references: [id])
  businessUnitId String?
  applications   Application[]
  category       JobCategory?
  region         Region?
  @@unique([ats, externalId])
  @@index([companyId, postedAt])
  @@index([category, postedAt])
  @@index([region])
}

model SearchEvent {
  id        String   @id @default(cuid())
  term      String
  slug      String
  companyId String?
  createdAt DateTime @default(now())
  company   Company? @relation(fields: [companyId], references: [id], onDelete: SetNull)
  @@index([slug, createdAt])
  @@index([createdAt])
}

model Application {
  id              String            @id @default(cuid())
  userId          String
  jobId           String
  status          ApplicationStatus @default(applied)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  firstResponseAt DateTime?
  user            User              @relation(fields: [userId], references: [id])
  job             Job               @relation(fields: [jobId], references: [id])
  @@index([userId, createdAt])
  @@index([status])
}

enum ApplicationStatus {
  applied
  interview
  offer
  rejected
}

model Profile {
  userId             String     @id
  phone              String?
  location           String?
  openToWork         Boolean    @default(true)
  visibility         Visibility @default(everyone)
  website            String?
  linkedin           String?
  github             String?
  portfolio          String?
  headline           String?
  yearsExperience    Int?
  seniority          Seniority?
  skills             Json?
  industries         Json?
  summary            String?
  desiredSalaryMin   Int?
  desiredSalaryMax   Int?
  salaryCurrency     String?
  remotePreference   RemotePreference @default(noPreference)
  willingToRelocate  Boolean?         @default(false)
  jobTypes           Json?
  preferredLocations Json?
  notifications      Json?
  updatedAt          DateTime   @updatedAt

  // ✅ New education fields
  educationSchool         String?
  educationDegree         String?
  educationField          String?
  educationGraduationYear Int?

  // ✅ New current job fields
  currentCompany          String?
  currentTitle            String?

  user               User       @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model ContactMessage {
  id        String   @id @default(cuid())
  name      String
  email     String
  subject   String
  message   String
  ip        String?
  createdAt DateTime @default(now())
}
